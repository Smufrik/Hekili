# Hunter: Beast Mastery
# Updated October 1, 2025
# Based on WoWSims MoP APL logic 

## Pre-combat
actions.precombat+=/aspect_of_the_iron_hawk,if=talent.iron_hawk.enabled&!buff.aspect_of_the_iron_hawk.up
actions.precombat+=/aspect_of_the_hawk,if=!talent.iron_hawk.enabled&!buff.aspect_of_the_iron_hawk.up
actions.precombat+=/call_pet_1,if=!pet.alive
actions.precombat+=/explosive_trap
actions.precombat+=/potion

## Main rotation
actions=call_pet_1,if=!pet.alive

# Pet management (continued)
actions+=/mend_pet,if=pet.alive&pet.health_pct<=settings.pet_healing&settings.pet_healing>0

# Interrupt
actions+=/counter_shot

# Use opener sequence during first 10 seconds
actions+=/call_action_list,name=opener,if=time<10

# Call action lists
actions+=/call_action_list,name=bestial_wrath_setup,if=cooldown.bestial_wrath.remains<=6&!buff.bestial_wrath.up
actions+=/call_action_list,name=cooldowns
actions+=/call_action_list,name=focus_fire_management
actions+=/call_action_list,name=burst,if=buff.bestial_wrath.up
actions+=/call_action_list,name=aoe,if=active_enemies>=2
actions+=/call_action_list,name=core_rotation,if=active_enemies<2
actions+=/call_action_list,name=movement,if=movement.distance>=5
actions+=/call_action_list,name=defensive,if=incoming_damage_5s>health.max*0.3
actions+=/call_action_list,name=pet_management
actions+=/call_action_list,name=tier_bonuses

# Use items and racials with Bestial Wrath (after opener)
actions+=/use_item,slot=hands,if=buff.bestial_wrath.up
actions+=/use_item,slot=trinket1,if=buff.bestial_wrath.up|cooldown.bestial_wrath.remains>20
actions+=/use_item,slot=trinket2,if=buff.bestial_wrath.up|cooldown.bestial_wrath.remains>20
actions+=/blood_fury,if=buff.bestial_wrath.up
actions+=/berserking,if=buff.bestial_wrath.up

# High priority abilities
actions+=/a_murder_of_crows,if=talent.a_murder_of_crows.enabled&(buff.bestial_wrath.up|cooldown.bestial_wrath.remains>20)
actions+=/kill_shot,if=target.health_pct<=20
actions+=/rapid_fire,if=buff.bestial_wrath.up|cooldown.bestial_wrath.remains>15
actions+=/kill_command,if=pet.alive
actions+=/stampede,if=buff.bestial_wrath.up|target.time_to_die<=20

## Opener sequence (first 10 seconds of combat)
# Sequence: Bestial Wrath -> Synapse Springs -> Stampede -> Rapid Fire -> A Murder of Crows -> Dire Beast -> Glaive Toss -> continue rotation
actions.opener+=/bestial_wrath,if=pet.alive&focus>=50
actions.opener+=/use_item,slot=hands
actions.opener+=/use_item,slot=trinket1
actions.opener+=/use_item,slot=trinket2
actions.opener+=/blood_fury
actions.opener+=/berserking
actions.opener+=/potion
actions.opener+=/stampede,if=time>5
actions.opener+=/rapid_fire,if=time>5
actions.opener+=/a_murder_of_crows,if=talent.a_murder_of_crows.enabled
actions.opener+=/dire_beast,if=talent.dire_beast.enabled
actions.opener+=/glaive_toss,if=talent.glaive_toss.enabled&focus>=15
actions.opener+=/serpent_sting,if=!debuff.serpent_sting.up
actions.opener+=/kill_command,if=pet.alive
actions.opener+=/arcane_shot,if=buff.bestial_wrath.up&focus>=35

# Talent abilities
actions+=/fervor,if=talent.fervor.enabled&focus<=37
actions+=/lynx_rush,if=talent.lynx_rush.enabled&pet.alive&(buff.bestial_wrath.up|cooldown.bestial_wrath.remains>15)
actions+=/powershot,if=talent.powershot.enabled&focus>=45
actions+=/dire_beast,if=talent.dire_beast.enabled
actions+=/barrage,if=talent.barrage.enabled&focus>=40

# DoT management
actions+=/serpent_sting,if=!debuff.serpent_sting.up
actions+=/cobra_shot,if=debuff.serpent_sting.remains<=6

# Filler
actions+=/glaive_toss,if=talent.glaive_toss.enabled&focus>=15
actions+=/arcane_shot,if=buff.bestial_wrath.up&focus>=35
actions+=/arcane_shot,if=focus>=79
actions+=/explosive_trap,if=!debuff.explosive_trap.up
actions+=/cobra_shot

## Bestial Wrath Setup
actions.bestial_wrath_setup+=/fervor,if=talent.fervor.enabled&focus<=37
actions.bestial_wrath_setup+=/serpent_sting,if=!debuff.serpent_sting.up
actions.bestial_wrath_setup+=/cobra_shot,if=debuff.serpent_sting.up&debuff.serpent_sting.remains<12

## Cooldowns
actions.cooldowns+=/bestial_wrath,if=pet.alive&focus>=50
actions.cooldowns+=/rapid_fire,if=buff.bestial_wrath.up|cooldown.bestial_wrath.remains>15
actions.cooldowns+=/stampede,if=buff.bestial_wrath.up|target.time_to_die<=20
actions.cooldowns+=/a_murder_of_crows,if=talent.a_murder_of_crows.enabled&(buff.bestial_wrath.up|cooldown.bestial_wrath.remains>20)
actions.cooldowns+=/dire_beast,if=talent.dire_beast.enabled
actions.cooldowns+=/lynx_rush,if=talent.lynx_rush.enabled&pet.alive&(buff.bestial_wrath.up|cooldown.bestial_wrath.remains>15)

## Focus Fire Management
actions.focus_fire_management+=/focus_fire,if=pet.alive&buff.frenzy.stack=5&buff.focus_fire.remains<=4&!buff.bestial_wrath.up&cooldown.bestial_wrath.remains>5

## Burst Phase
actions.burst+=/kill_command,if=pet.alive
actions.burst+=/arcane_shot,if=focus>=35
actions.burst+=/glaive_toss,if=talent.glaive_toss.enabled&focus>=15

## Core Rotation (Single Target)
actions.core_rotation+=/kill_shot,if=target.health.pct<=20
actions.core_rotation+=/kill_command,if=pet.alive
actions.core_rotation+=/serpent_sting,if=!debuff.serpent_sting.up
actions.core_rotation+=/arcane_shot,if=focus>=79
actions.core_rotation+=/cobra_shot,if=debuff.serpent_sting.remains<=6
actions.core_rotation+=/cobra_shot

## Movement
actions.movement+=/disengage

## Defensive
actions.defensive+=/exhilaration,if=health.pct<=50
actions.defensive+=/deterrence,if=incoming_damage_5s>health.max*0.5

## Pet Management
actions.pet_management+=/call_pet_1,if=!pet.alive
actions.pet_management+=/mend_pet,if=pet.alive&pet.health_pct<=settings.pet_healing&settings.pet_healing>0

## Tier Bonuses
actions.tier_bonuses+=/use_item,slot=hands,if=buff.bestial_wrath.up
actions.tier_bonuses+=/use_item,slot=trinket1,if=buff.bestial_wrath.up|cooldown.bestial_wrath.remains>20
actions.tier_bonuses+=/use_item,slot=trinket2,if=buff.bestial_wrath.up|cooldown.bestial_wrath.remains>20

## AoE rotation (2+ targets)
actions.aoe+=/multi_shot,if=active_enemies>=3
actions.aoe+=/kill_command,if=pet.alive&active_enemies<3
actions.aoe+=/multi_shot,if=active_enemies>=2&(buff.beast_cleave.remains<1.5|!buff.beast_cleave.up)&focus>=40
actions.aoe+=/serpent_sting,cycle_targets=1,if=!debuff.serpent_sting.up&active_enemies<=4&target.time_to_die>10
actions.aoe+=/glaive_toss,if=talent.glaive_toss.enabled&focus>=15&active_enemies>=3
actions.aoe+=/barrage,if=talent.barrage.enabled&focus>=40&active_enemies>=3
actions.aoe+=/explosive_trap,if=active_enemies>=3&!debuff.explosive_trap.up
actions.aoe+=/arcane_shot,if=focus>=79&active_enemies<3
actions.aoe+=/cobra_shot
